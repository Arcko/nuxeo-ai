<?xml version="1.0"?>
<component name="org.nuxeo.pipes.mock.streams">

  <require>org.nuxeo.runtime.stream.pipes.Pipeline</require>

  <extension target="org.nuxeo.runtime.stream.service" point="logConfig">
    <logConfig name="test_log_pipes">
      <option name="retention">3h</option>
    </logConfig>
  </extension>

  <!-- Turn on the picture view pipe -->
  <extension point="pipes" target="org.nuxeo.runtime.stream.pipes.Pipeline">
    <pipe id="pipe.images" enabled="true" />
  </extension>

  <extension point="pipes" target="org.nuxeo.runtime.stream.pipes.Pipeline">
    <pipe id="pipe.doc" enabled="false" function="org.nuxeo.runtime.stream.pipes.pipes.DocumentPipeFunction">
      <supplier>
        <event>willNotBeUsed</event>
      </supplier>
      <consumer>
        <stream name="willbemergedandlost" />
      </consumer>
    </pipe>
  </extension>

  <extension point="pipes" target="org.nuxeo.runtime.stream.pipes.Pipeline">
    <pipe id="pipe.doc" enabled="true" function="org.nuxeo.runtime.stream.pipes.pipes.DocumentPipeFunction">
      <supplier>
        <event>myDocEvent</event>
        <event>anotherEvent</event>
      </supplier>
      <consumer>
        <stream name="text" />
        <stream name="text.extra" />
      </consumer>
    </pipe>
  </extension>

  <extension target="org.nuxeo.runtime.stream.service" point="streamProcessor">
    <streamProcessor name="basicProcessor" logConfig="test_log_pipes" defaultConcurrency="1" defaultPartitions="4"
                     class="org.nuxeo.runtime.stream.pipes.PassThrough">
      <option name="source">text</option>
      <option name="sink">text.pass,text.other</option>
    </streamProcessor>
  </extension>

  <extension target="org.nuxeo.runtime.stream.service" point="streamProcessor">
    <streamProcessor name="testProcessor" logConfig="test_log_pipes" defaultConcurrency="1" defaultPartitions="4"
                     class="org.nuxeo.runtime.stream.pipes.SimpleFilterFunction">
      <option name="source">text.pass</option>
      <option name="sink">text.out</option>
    </streamProcessor>
  </extension>

</component>
