<?xml version="1.0" encoding="UTF-8"?>

<component name="org.nuxeo.ai.model.custom.documents" version="1.0.0">
  <require>org.nuxeo.ecm.core.CoreExtensions</require>
  <extension target="org.nuxeo.ecm.core.schema.TypeService" point="schema">
    <schema name="ai_corpus" prefix="ai_corpus" override="true" src="data/schemas/ai_corpus.xsd"/>
    <schema name="ai_model" prefix="ai_model" override="true" src="data/schemas/ai_model.xsd"/>
  </extension>
  <extension target="org.nuxeo.ecm.core.schema.TypeService" point="doctype">
    <doctype name="AI_Corpus" extends="Document">
      <schema name="ai_corpus"/>
      <schema name="dublincore"/>
      <schema name="common"/>
      <schema name="uid"/>
      <facet name="HiddenInNavigation"/>
      <facet name="Commentable"/>
    </doctype>
    <doctype name="Folder" append="true">
      <subtypes>
        <type>AI_Corpus</type>
      </subtypes>
    </doctype>
    <doctype name="Workspace" append="true">
      <subtypes>
        <type>AI_Corpus</type>
      </subtypes>
    </doctype>
    <doctype name="AI_Model" extends="Document">
      <schema name="ai_model"/>
      <schema name="dublincore"/>
      <schema name="common"/>
      <schema name="uid"/>
      <facet name="Versionable"/>
      <facet name="HiddenInNavigation"/>
      <facet name="Commentable"/>
    </doctype>
    <doctype name="Folder" append="true">
      <subtypes>
        <type>AI_Model</type>
      </subtypes>
    </doctype>
    <doctype name="Workspace" append="true">
      <subtypes>
        <type>AI_Model</type>
      </subtypes>
    </doctype>
  </extension>
  <extension target="org.nuxeo.ecm.core.lifecycle.LifeCycleService" point="types">
    <types>
      <type name="AI_Corpus">default</type>
    </types>
    <types>
      <type name="AI_Model">AI_Model_Lifecycle</type>
    </types>
  </extension>
  <extension target="org.nuxeo.ecm.core.lifecycle.LifeCycleService" point="lifecycle">
    <lifecycle name="AI_Model_Lifecycle" defaultInitial="created">
      <transitions>
        <transition name="startTraining" destinationState="training">
          <description>Start training of a new model</description>
        </transition>
        <transition name="trainFinished" destinationState="trained">
          <description>Model training is done</description>
        </transition>
        <transition name="to_publish" destinationState="published">
          <description>Publish a trained model</description>
        </transition>
        <transition name="stop_publish" destinationState="trained">
          <description>Stop published model</description>
        </transition>
      </transitions>
      <states>
        <state name="created" description="Initial model. Still not training" initial="true">
          <transitions>
            <transition>startTraining</transition>
          </transitions>
        </state>
        <state name="training" description="Model in training">
          <transitions>
            <transition>trainFinished</transition>
          </transitions>
        </state>
        <state name="trained" description="Model training is done and model is ready">
          <transitions>
            <transition>to_publish</transition>
          </transitions>
        </state>
        <state name="published" description="Model is currently published">
          <transitions>
            <transition>stop_publish</transition>
          </transitions>
        </state>
      </states>
    </lifecycle>
  </extension>
  <extension target="org.nuxeo.ecm.directory.GenericDirectory" point="directories">
    <directory name="InputOutputDataType" extends="template-vocabulary">
      <dataFile>data/vocabularies/InputOutputDataType.csv</dataFile>
    </directory>
    <directory name="AiTrainingEngines" extends="template-vocabulary">
      <dataFile>data/vocabularies/AiTrainingEngines.csv</dataFile>
    </directory>
  </extension>
</component>
